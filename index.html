<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>SkyQ Layout with Your Pastebin M3U</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(to right, #00204a, #003c8f);
    color: white;
    display: flex;
    height: 100vh;
  }
  .sidebar {
    width: 220px;
    background: #001d3d;
    padding: 20px;
    display: flex;
    flex-direction: column;
  }
  .menu-item {
    cursor: pointer;
    font-size: 16px;
    opacity: 0.7;
    padding: 8px 10px;
    border-left: 3px solid transparent;
    transition: 0.2s;
  }
  .menu-item:hover,
  .menu-item.active {
    background-color: #0051a2;
    opacity: 1;
    border-left: 3px solid #00b4ff;
  }
  .submenu {
    margin-left: 15px;
    margin-top: 10px;
    display: none;
    flex-direction: column;
  }
  .submenu.active {
    display: flex;
  }
  .submenu-item {
    cursor: pointer;
    padding: 6px 10px;
    font-size: 14px;
    opacity: 0.7;
    border-left: 3px solid transparent;
    transition: 0.2s;
  }
  .submenu-item:hover,
  .submenu-item.active {
    background-color: #003877;
    opacity: 1;
    border-left: 3px solid #00b4ff;
  }
  .main {
    flex: 1;
    padding: 20px;
    display: flex;
    flex-direction: column;
  }
  .top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .logo {
    font-size: 24px;
    font-weight: bold;
    color: #00b4ff;
  }
  #time {
    font-size: 18px;
    margin-right: 10px;
  }
  .preview-box {
    margin-top: 20px;
    width: 100%;
    max-width: 600px;
    height: 340px;
    background: black;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #ccc;
    position: relative;
  }
  video {
    max-width: 100%;
    max-height: 100%;
    background: black;
  }
  .channels-list {
    margin-top: 20px;
    overflow-y: auto;
    max-height: calc(100vh - 420px);
  }
  .channel-item {
    cursor: pointer;
    padding: 8px 12px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    transition: background-color 0.2s;
  }
  .channel-item:hover,
  .channel-item.active {
    background-color: #0051a2;
  }
</style>
</head>
<body>

<div class="sidebar">
  <div class="menu-item" id="tvGuideBtn">TV Guide</div>
  <div class="submenu" id="categoryMenu">
    <div class="submenu-item active" data-category="all">All Channels</div>
    <div class="submenu-item" data-category="Entertainment">Entertainment</div>
    <div class="submenu-item" data-category="Kids">Kids</div>
    <div class="submenu-item" data-category="Sports">Sports</div>
    <div class="submenu-item" data-category="Music">Music</div>
    <div class="submenu-item" data-category="Films">Films</div>
  </div>
</div>

<div class="main">
  <div class="top-bar">
    <div class="logo">sky</div>
    <div id="time">--:--</div>
  </div>

  <div class="preview-box" id="previewBox">
    <div id="previewText">Select a channel to preview</div>
    <video id="previewVideo" controls style="display:none;"></video>
  </div>

  <div class="channels-list" id="channelsList">
    Loading channels...
  </div>
</div>

<script>
  const pastebinUrl = "https://pastebin.com/raw/VzBfHXLJ";

  const tvGuideBtn = document.getElementById("tvGuideBtn");
  const categoryMenu = document.getElementById("categoryMenu");
  const categoryItems = categoryMenu.querySelectorAll(".submenu-item");
  const channelsList = document.getElementById("channelsList");
  const previewVideo = document.getElementById("previewVideo");
  const previewText = document.getElementById("previewText");
  const previewBox = document.getElementById("previewBox");

  let currentCategory = "all";
  let currentChannel = null;
  let fullscreen = false;
  let channels = [];

  // Show/hide category menu when clicking TV Guide
  tvGuideBtn.addEventListener("click", () => {
    categoryMenu.classList.toggle("active");
  });

  // Parse M3U content from pastebin into channel objects
  function parseM3U(data) {
    const lines = data.split("\n").map(l => l.trim()).filter(l => l.length > 0);
    let parsedChannels = [];
    for (let i = 0; i < lines.length; i++) {
      if (lines[i].startsWith("#EXTINF")) {
        // Parse #EXTINF line
        const infoLine = lines[i];
        const urlLine = lines[i + 1];
        i++; // Skip URL line next loop

        // Extract group-title, channel name
        const groupMatch = infoLine.match(/group-title="([^"]*)"/i);
        const nameMatch = infoLine.match(/,(.+)$/);

        const group = groupMatch ? groupMatch[1] : "Others";
        const name = nameMatch ? nameMatch[1] : "Unknown";

        parsedChannels.push({
          name: name,
          url: urlLine,
          category: group
        });
      }
    }
    return parsedChannels;
  }

  // Render channels filtered by current category
  function renderChannels() {
    channelsList.innerHTML = "";
    let filteredChannels = channels;
    if (currentCategory !== "all") {
      filteredChannels = channels.filter(ch => ch.category === currentCategory);
    }
    if (filteredChannels.length === 0) {
      channelsList.innerHTML = "<p>No channels found in this category.</p>";
      return;
    }
    filteredChannels.forEach(ch => {
      const div = document.createElement("div");
      div.className = "channel-item";
      div.textContent = ch.name;
      div.dataset.url = ch.url;
      div.dataset.name = ch.name;
      div.addEventListener("click", () => {
        if (currentChannel === ch.name) {
          // Same channel clicked twice: toggle fullscreen
          if (!fullscreen) {
            enterFullscreen(previewBox);
            fullscreen = true;
          } else {
            exitFullscreen();
            fullscreen = false;
          }
        } else {
          // Different channel clicked: load preview
          currentChannel = ch.name;
          fullscreen = false;
          exitFullscreen();
          previewVideo.src = ch.url;
          previewVideo.style.display = "block";
          previewVideo.play();
          previewText.style.display = "none";
          // Highlight selected channel
          document.querySelectorAll(".channel-item").forEach(item => {
            item.classList.toggle("active", item.dataset.name === ch.name);
          });
        }
      });
      channelsList.appendChild(div);
    });
  }

  // Fullscreen helpers
  function enterFullscreen(elem) {
    if (elem.requestFullscreen) {
      elem.requestFullscreen();
    } else if (elem.webkitRequestFullscreen) {
      elem.webkitRequestFullscreen();
    } else if (elem.msRequestFullscreen) {
      elem.msRequestFullscreen();
    }
  }
  function exitFullscreen() {
    if (document.exitFullscreen) {
      document.exitFullscreen();
    } else if (document.webkitExitFullscreen) {
      document.webkitExitFullscreen();
    } else if (document.msExitFullscreen) {
      document.msExitFullscreen();
    }
  }

  // Handle category clicks
  categoryItems.forEach(item => {
    item.addEventListener("click", () => {
      categoryItems.forEach(i => i.classList.remove("active"));
      item.classList.add("active");
      currentCategory = item.getAttribute("data-category");
      currentChannel = null;
      fullscreen = false;
      previewVideo.pause();
      previewVideo.style.display = "none";
      previewText.style.display = "block";
      previewText.textContent = "Select a channel to preview";
      renderChannels();
    });
  });

  // Update time every 10 seconds
  function updateTime() {
    const now = new Date();
    let hours = now.getHours();
    let minutes = now.getMinutes();
    const ampm = hours >= 12 ? "pm" : "am";
    hours = hours % 12 || 12;
    minutes = minutes < 10 ? "0" + minutes : minutes;
    document.getElementById("time").textContent = `${hours}:${minutes}${ampm}`;
  }
  updateTime();
  setInterval(updateTime, 10000);

  // Fetch and load channels from Pastebin, then render
  fetch(pastebinUrl)
    .then(res => {
      if (!res.ok) throw new Error("Failed to fetch M3U data");
      return res.text();
    })
    .then(text => {
      channels = parseM3U(text);
      renderChannels();
    })
    .catch(err => {
      channelsList.innerHTML = "<p style='color:red;'>Failed to load channels: " + err.message + "</p>";
    });

</script>

</body>
</html>
