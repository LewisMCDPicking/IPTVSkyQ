<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SkyQ Layout with HLS.js</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(to right, #00204a, #003c8f);
      color: white;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    /* Sidebar */
    .sidebar {
      width: 220px;
      background: #001d3d;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      overflow-y: auto;
    }
    .menu-item, .submenu-item {
      font-size: 16px;
      cursor: pointer;
      opacity: 0.8;
      transition: 0.2s;
      padding: 5px 10px;
      border-left: 3px solid transparent;
      user-select: none;
    }
    .menu-item:hover, .submenu-item:hover,
    .menu-item.active, .submenu-item.active {
      background-color: #0051a2;
      opacity: 1;
      border-left: 3px solid #00b4ff;
    }
    .submenu {
      margin-left: 15px;
      margin-top: 5px;
      display: none;
      flex-direction: column;
      gap: 8px;
    }
    /* Main content */
    .main {
      flex: 1;
      padding: 20px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    .logo {
      font-size: 24px;
      font-weight: bold;
      color: #00b4ff;
    }
    #time {
      font-size: 18px;
      margin-right: 10px;
    }
    .preview-box {
      width: 100%;
      max-width: 700px;
      height: 400px;
      background: black;
      position: relative;
    }
    video {
      width: 100%;
      height: 100%;
      background: black;
      object-fit: contain;
    }
    .epg {
      margin-top: 30px;
      background: rgba(255,255,255,0.05);
      padding: 15px;
      border-radius: 8px;
      max-height: 300px;
      overflow-y: auto;
    }
    .epg table {
      width: 100%;
      border-collapse: collapse;
      color: #ccc;
    }
    .epg th, .epg td {
      padding: 8px;
      border: 1px solid rgba(255,255,255,0.1);
      font-size: 14px;
    }
    .epg th {
      background: rgba(255,255,255,0.1);
      color: #eee;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="menu-item active" id="tvguideBtn">TV Guide â–¾</div>
    <div id="categoryList" style="display: flex; flex-direction: column; gap: 8px; margin-left: 10px;"></div>
  </div>

  <div class="main">
    <div class="top-bar">
      <div class="logo">sky</div>
      <div id="time">--:--</div>
    </div>

    <div class="preview-box">
      <video id="videoPlayer" controls muted></video>
    </div>

    <div class="epg" id="epg">
      <h3>TV Guide</h3>
      <table>
        <thead>
          <tr>
            <th>Channel</th>
            <th>11:30am</th>
            <th>12:00pm</th>
            <th>12:30pm</th>
          </tr>
        </thead>
        <tbody id="epgBody">
          <!-- Sample EPG rows -->
          <tr>
            <td>BBC One</td>
            <td>The Great Food Guys</td>
            <td>Homes Under the Hammer</td>
            <td>BBC News</td>
          </tr>
          <tr>
            <td>ITV</td>
            <td>James Martin</td>
            <td>ITV Lunchtime News</td>
            <td>ITV Racing</td>
          </tr>
          <tr>
            <td>Channel 4</td>
            <td>Come Dine With Me</td>
            <td>Four in a Bed</td>
            <td>Four in a Bed</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- HLS.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <script>
    // Time update
    function updateTime() {
      const now = new Date();
      let hours = now.getHours();
      let minutes = now.getMinutes();
      const ampm = hours >= 12 ? 'pm' : 'am';
      hours = hours % 12 || 12;
      minutes = minutes < 10 ? '0' + minutes : minutes;
      document.getElementById('time').textContent = `${hours}:${minutes}${ampm}`;
    }
    updateTime();
    setInterval(updateTime, 10000);

    // Channel data from your Pastebin link
    // Example format: { name: "BBC One", url: "http://example.m3u8", category: "Entertainment" }
    const channels = [
      // Below I will pull your Pastebin link and parse it dynamically
    ];

    // Because we cannot fetch raw Pastebin content due to CORS in local testing,
    // I will instead embed your Pastebin raw URL data here.
    // You must replace the below array with your actual channel objects parsed from your m3u file

    // For demo, here is a minimal example:
    const channelList = [
      { name: "BBC One", url: "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8", category: "Entertainment" },
      { name: "ITV", url: "https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8", category: "Entertainment" },
      { name: "Kids Channel 1", url: "https://test-streams.mux.dev/test_001/stream.m3u8", category: "Kids" },
      { name: "Sports Channel", url: "https://test-streams.mux.dev/test_002/stream.m3u8", category: "Sports" },
      { name: "Music Channel", url: "https://bitdash-a.akamaihd.net/content/MI201109210084_1/m3u8s/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.m3u8", category: "Music" }
    ];

    // Globals
    let currentCategory = "All Channels";
    let currentPlaying = null;
    let video = document.getElementById("videoPlayer");
    let hls = null;

    // Build category list and channel list UI
    function buildCategoryMenu() {
      const categorySet = new Set(channelList.map(c => c.category));
      const categories = Array.from(categorySet).sort();
      categories.unshift("All Channels");

      const container = document.getElementById("categoryList");
      container.innerHTML = "";

      categories.forEach(cat => {
        const div = document.createElement("div");
        div.textContent = cat;
        div.className = "submenu-item";
        if(cat === "All Channels") div.classList.add("active");
        div.onclick = () => {
          document.querySelectorAll(".submenu-item").forEach(el => el.classList.remove("active"));
          div.classList.add("active");
          currentCategory = cat;
          buildChannelList(cat);
          stopVideo();
        };
        container.appendChild(div);
      });
    }

    function buildChannelList(category) {
      const epgBody = document.getElementById("epgBody");
      epgBody.innerHTML = "";

      const filteredChannels = category === "All Channels" ? channelList : channelList.filter(c => c.category === category);

      filteredChannels.forEach(ch => {
        const tr = document.createElement("tr");
        const tdName = document.createElement("td");
        tdName.textContent = ch.name;
        tdName.style.cursor = "pointer";
        tdName.style.color = "#00b4ff";

        // Handle click to preview or fullscreen toggle
        tdName.onclick = () => {
          if (currentPlaying === ch.name) {
            toggleFullScreen();
          } else {
            playChannel(ch);
          }
        };

        tr.appendChild(tdName);
        // Placeholder EPG data (could be dynamic or expanded later)
        ["The Great Food Guys", "Homes Under the Hammer", "BBC News"].forEach(show => {
          const td = document.createElement("td");
          td.textContent = show;
          tr.appendChild(td);
        });
        epgBody.appendChild(tr);
      });
    }

    function playChannel(channel) {
      currentPlaying = channel.name;
      if (hls) {
        hls.destroy();
        hls = null;
      }

      if (Hls.isSupported()) {
        hls = new Hls();
        hls.loadSource(channel.url);
        hls.attachMedia(video);
        hls.on(Hls.Events.ERROR, function(event, data) {
          console.error("HLS error:", data);
          // You can show a message if needed here
        });
        hls.on(Hls.Events.MANIFEST_PARSED, function() {
          video.play();
        });
      } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
        video.src = channel.url;
        video.addEventListener("loadedmetadata", function() {
          video.play();
        });
      } else {
        alert("Your browser does not support HLS.");
      }
    }

    function stopVideo() {
      if (hls) {
        hls.destroy();
        hls = null;
      }
      video.pause();
      video.src = "";
      currentPlaying = null;
      exitFullScreen();
    }

    function toggleFullScreen() {
      if (!document.fullscreenElement) {
        video.requestFullscreen().catch(err => {
          console.warn(`Fullscreen request failed: ${err.message}`);
        });
      } else {
        document.exitFullscreen();
      }
    }

    function exitFullScreen() {
      if (document.fullscreenElement) {
        document.exitFullscreen();
      }
    }

    // Initialize UI
    buildCategoryMenu();
    buildChannelList("All Channels");

    // Optional: TV Guide button toggle submenu (could be expanded)
    document.getElementById("tvguideBtn").onclick = () => {
      const catList = document.getElementById("categoryList");
      catList.style.display = catList.style.display === "none" ? "flex" : "none";
    };
  </script>
</body>
</html>
