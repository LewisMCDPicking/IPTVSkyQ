<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>SkyQ Layout with Categories & Preview</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(to right, #00204a, #003c8f);
    color: white;
    display: flex;
    height: 100vh;
  }
  /* Sidebar */
  .sidebar {
    width: 200px;
    background: #001d3d;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .menu-item {
    font-size: 16px;
    opacity: 0.7;
    transition: 0.2s;
    padding: 8px 10px;
    border-left: 3px solid transparent;
    cursor: pointer;
    user-select: none;
  }
  .menu-item:hover,
  .menu-item.active {
    background-color: #0051a2;
    opacity: 1;
    border-left: 3px solid #00b4ff;
  }
  .submenu {
    margin-left: 15px;
    display: none;
    flex-direction: column;
    gap: 5px;
  }
  .submenu.active {
    display: flex;
  }

  /* Main content */
  .main {
    flex: 1;
    padding: 20px;
    display: flex;
    flex-direction: column;
  }
  .top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .logo {
    font-size: 24px;
    font-weight: bold;
    color: #00b4ff;
  }
  #time {
    font-size: 18px;
    margin-right: 10px;
  }
  .preview-box {
    margin-top: 20px;
    width: 100%;
    max-width: 600px;
    height: 340px;
    background: black;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #ccc;
    position: relative;
  }
  video {
    width: 100%;
    height: 100%;
    background: black;
  }
  .channel-list {
    margin-top: 20px;
    max-width: 600px;
    overflow-y: auto;
    flex-grow: 1;
  }
  .channel-item {
    padding: 8px 10px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    cursor: pointer;
  }
  .channel-item:hover {
    background-color: #0051a2;
  }
</style>
</head>
<body>
  <div class="sidebar">
    <div class="menu-item active" id="menu-tvguide">TV Guide</div>
    <div class="submenu active" id="category-list">
      <!-- Categories will be dynamically inserted here -->
    </div>
  </div>

  <div class="main">
    <div class="top-bar">
      <div class="logo">sky</div>
      <div id="time">--:--</div>
    </div>

    <div class="preview-box" id="preview-box">
      <video id="preview-video" controls muted></video>
      <div id="preview-text">Select a channel to watch</div>
    </div>

    <div class="channel-list" id="channel-list">
      <!-- Channels for selected category will appear here -->
    </div>
  </div>

<script>
  // Update time display
  function updateTime() {
    const now = new Date();
    let hours = now.getHours();
    let minutes = now.getMinutes();
    const ampm = hours >= 12 ? 'pm' : 'am';
    hours = hours % 12 || 12;
    minutes = minutes < 10 ? '0' + minutes : minutes;
    document.getElementById('time').textContent = `${hours}:${minutes}${ampm}`;
  }
  updateTime();
  setInterval(updateTime, 10000);

  // Elements
  const categoryListEl = document.getElementById('category-list');
  const channelListEl = document.getElementById('channel-list');
  const previewVideoEl = document.getElementById('preview-video');
  const previewTextEl = document.getElementById('preview-text');

  // Data
  let channelsByCategory = {};
  let currentCategory = null;
  let currentChannelUrl = null;
  let previewVideoVisible = false;

  // CORS proxy + pastebin raw m3u url
  const corsProxy = 'https://cors-anywhere.herokuapp.com/';
  const m3uUrl = 'https://pastebin.com/raw/VzBfHXLJ';

  // Fetch and parse M3U playlist
  fetch(corsProxy + m3uUrl)
    .then(response => {
      if (!response.ok) throw new Error('Network response was not ok');
      return response.text();
    })
    .then(data => {
      parseM3U(data);
      buildCategoryMenu();
      if (currentCategory) {
        showChannels(currentCategory);
      }
    })
    .catch(error => {
      alert('Failed to load channels: ' + error.message);
    });

  // Parse M3U text, group channels by category (tvg-group)
  function parseM3U(m3uText) {
    const lines = m3uText.split('\n');
    channelsByCategory = {};
    let currentChannel = null;

    for (let i = 0; i < lines.length; i++) {
      let line = lines[i].trim();
      if (line.startsWith('#EXTINF')) {
        // Example: #EXTINF:-1 tvg-id="BBC1.uk" tvg-name="BBC One" tvg-logo="..." group-title="Entertainment",BBC One
        currentChannel = {};
        const groupMatch = line.match(/group-title="([^"]*)"/i);
        currentChannel.category = groupMatch ? groupMatch[1] : 'Uncategorized';

        const nameMatch = line.match(/,(.*)$/);
        currentChannel.name = nameMatch ? nameMatch[1] : 'Unknown';

        // Sometimes logo and tvg-id are here, can parse if needed
      } else if (line && !line.startsWith('#')) {
        // This is the URL line
        if (currentChannel) {
          currentChannel.url = line;
          // Add to category list
          if (!channelsByCategory[currentChannel.category]) {
            channelsByCategory[currentChannel.category] = [];
          }
          channelsByCategory[currentChannel.category].push(currentChannel);
          currentChannel = null;
        }
      }
    }

    // Set default category to first category found
    const categories = Object.keys(channelsByCategory);
    if (categories.length > 0) {
      currentCategory = categories[0];
    }
  }

  // Build category menu in sidebar
  function buildCategoryMenu() {
    categoryListEl.innerHTML = '';
    Object.keys(channelsByCategory).forEach(cat => {
      const catEl = document.createElement('div');
      catEl.className = 'menu-item';
      catEl.textContent = cat;
      catEl.onclick = () => {
        currentCategory = cat;
        setActiveCategory(catEl);
        showChannels(cat);
        clearPreview();
      };
      categoryListEl.appendChild(catEl);
    });
    setActiveCategory(categoryListEl.firstChild);
  }

  function setActiveCategory(activeEl) {
    [...categoryListEl.children].forEach(el => el.classList.remove('active'));
    if (activeEl) activeEl.classList.add('active');
  }

  // Show channels for a given category
  function showChannels(category) {
    channelListEl.innerHTML = '';
    const channels = channelsByCategory[category];
    channels.forEach(ch => {
      const chEl = document.createElement('div');
      chEl.className = 'channel-item';
      chEl.textContent = ch.name;
      chEl.onclick = () => {
        onChannelClick(ch);
      };
      channelListEl.appendChild(chEl);
    });
  }

  // Handle channel click: show preview, toggle fullscreen if same channel clicked twice
  function onChannelClick(channel) {
    if (currentChannelUrl === channel.url) {
      toggleFullScreen();
      return;
    }
    currentChannelUrl = channel.url;
    showPreview(channel.url);
  }

  // Show preview video
  function showPreview(url) {
    previewTextEl.style.display = 'none';
    previewVideoEl.style.display = 'block';
    previewVideoEl.src = url;
    previewVideoEl.play();
    previewVideoVisible = true;
    exitFullScreenIfNeeded();
  }

  // Clear preview
  function clearPreview() {
    previewVideoEl.pause();
    previewVideoEl.src = '';
    previewVideoEl.style.display = 'none';
    previewTextEl.style.display = 'flex';
    previewTextEl.textContent = 'Select a channel to watch';
    currentChannelUrl = null;
    previewVideoVisible = false;
    exitFullScreenIfNeeded();
  }

  // Toggle fullscreen for video container
  function toggleFullScreen() {
    const elem = document.getElementById('preview-box');
    if (!document.fullscreenElement) {
      if (elem.requestFullscreen) {
        elem.requestFullscreen();
      } else if (elem.webkitRequestFullscreen) { /* Safari */
        elem.webkitRequestFullscreen();
      } else if (elem.msRequestFullscreen) { /* IE11 */
        elem.msRequestFullscreen();
      }
    } else {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      }
    }
  }

  // Exit fullscreen if any
  function exitFullScreenIfNeeded() {
    if (document.fullscreenElement) {
      document.exitFullscreen();
    }
  }
</script>
</body>
</html>
